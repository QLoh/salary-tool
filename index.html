<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><span id="year"></span>年勞保健保勞退查詢</title>
    <style>
        body {
            font-family: Arial, "Helvetica Neue", Helvetica, sans-serif, "微軟正黑體", "Microsoft JhengHei";
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            background-color: #f8f8f8;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h4 {
            color: #2980b9;
            margin-top: 0;
            padding-bottom: 5px;
            border-bottom: 1px dashed #ccc;
        }
        .input-group {
            display: flex;
            margin-bottom: 20px;
        }
        #salary {
            flex-grow: 1;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #ccc;
            border-radius: 5px 0 0 5px;
        }
        .input-group button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 0 5px 5px 0;
            transition: background-color 0.3s;
        }
        .input-group button:hover {
            background-color: #2980b9;
        }
        #output {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .section {
            margin-bottom: 15px;
        }
        .section ul {
            list-style: none;
            padding: 0;
            margin: 5px 0 10px 0;
            line-height: 1.8;
        }
        .total {
            font-weight: bold;
            font-size: 1.1em;
            color: #c0392b;
            padding: 5px 0;
            border-top: 1px solid #ddd;
            margin-top: 10px;
        }
        .divider {
            border: 0;
            height: 1px;
            background-color: #eee;
            margin: 15px 0;
        }
        .description-box {
            background-color: #ecf0f1;
            padding: 15px;
            border-left: 5px solid #3498db;
            margin-top: 20px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>

    <h1><span id="year"></span>年勞保健保勞退查詢</h1>

    <p>只要輸入月薪，就能立刻查投保級距，對照薪資單不再霧煞煞。</p>

    <div class="input-group">
        <input type="number" id="salary" placeholder="請輸入月薪 (如：50000)">
        <button onclick="calculate()">查詢</button>
    </div>

    <div id="output">
        </div>

    <div class="description-box">
        <h4>使用說明</h4>
        <ul>
            <li>本工具方便勞工快速查詢保險級距。</li>
            <li>可連線勞保局 e化系統比對投保資料。</li>
            <li>計算方式以「月」(30日) 為單位。</li>
            <li>健保僅算本人保費，不含眷屬保費。</li>
            <li>勞退依實際工資提繳 6%，不看級距。</li>
        </ul>
        <p style="color: #c0392b; font-weight: bold;">薪資總額的計算，依《勞基法》第2條第3款規定，除了本薪外，固定給付的獎金、津貼也要算進去。工資項目是否要列入，如有疑慮，請向勞動部或縣市政府勞工局諮詢確認。</p>
    </div>


    <script>
        // 輔助函式：根據薪資在級距表中找到對應的費用
        function getLevel(salary, list) {
            for (let i = 0; i < list.length; i++) {
                if (salary <= list[i].level) return list[i];
            }
            return list[list.length - 1];
        }

        function calculate() {
            const input = document.getElementById("salary").value.trim();

            if (!/^\d+$/.test(input)) {
                document.getElementById("output").innerHTML = "<p>⚠️ 請輸入整數金額，不要有小數點或文字。</p>";
                return;
            }

            const salary = parseInt(input, 10);
            if (salary <= 0) {
                document.getElementById("output").innerHTML = "<p>⚠️ 月薪必須大於 0。</p>";
                return;
            }

            fetch("grades.json")
                .then(res => res.json())
                .then(grades => {
                    // 1. 普保 (普通勞保) 費用：員工和公司負擔的基礎
                    const labor = getLevel(salary, grades.labor);
                    // 2. 健保 費用
                    const health = getLevel(salary, grades.health);
                    // 3. 職保 (災保) 費用：僅公司負擔
                    const job = getLevel(salary, grades.job);
                    
                    // 4. 勞退 (最高 150,000 元)
                    const pension_base = Math.min(salary, 150000); // 勞退最高級距 150,000 元
                    const pension = {
                        level: salary,
                        company: Math.round(pension_base * 0.06),
                        employee: 0 // 勞退員工提繳為自願性，預設為 0
                    };

                    // 修正投保級距的計算與顯示邏輯
                    const labor_level_to_calculate = Math.min(salary, 45800); // 普保最高 45,800 元
                    const job_level_to_calculate = Math.min(salary, 72800); // 職保最高 72,800 元
                    
                    // 勞保/職保/健保/勞退的實際投保級距 (可能因投保上限而採用較低級距)
                    const labor_ins_level = getLevel(labor_level_to_calculate, grades.labor).level;
                    const job_ins_level = getLevel(job_level_to_calculate, grades.job).level;
                    const health_ins_level = health.level;


                    // 計算總額
                    // 個人負擔 = 普保 + 健保 + 勞退(0)
                    const totalEmp = labor.employee + health.employee + pension.employee; 
                    // 公司負擔總額 = 普保 + 職保 + 健保 + 勞退
                    const totalComp = labor.company + job.company + health.company + pension.company;

                    document.getElementById("output").innerHTML = `
                        <div class="section">
                            <h4>投保級距</h4>
                            <ul>
                                <li>勞保（普保）：${labor_ins_level.toLocaleString()} 元（最高 45,800 元）</li>
                                <li>職保（災保）：${job_ins_level.toLocaleString()} 元（最高 72,800 元）</li>
                                <li>健保：${health_ins_level.toLocaleString()} 元</li>
                                <li>勞退：${pension_base.toLocaleString()} 元（實際工資，最高 150,000 元）</li>
                            </ul>
                        </div>
                        <hr class="divider">
                        <div class="section">
                            <h4>個人負擔</h4>
                            <ul>
                                <li>勞保（普保）：${labor.employee.toLocaleString()} 元</li>
                                <li>健保：${health.employee.toLocaleString()} 元</li>
                                <li>勞退：0 元</li>
                            </ul>
                            <div class="total">合計：${totalEmp.toLocaleString()} 元</div>
                        </div>
                        <hr class="divider">
                        <div class="section">
                            <h4>公司負擔</h4>
                            <ul>
                                <li>勞保（普保）：${labor.company.toLocaleString()} 元</li>
                                <li>職保（災保）：${job.company.toLocaleString()} 元</li>
                                <li>健保：${health.company.toLocaleString()} 元</li>
                                <li>勞退：${pension.company.toLocaleString()} 元</li>
                            </ul>
                            <div class="total">合計：${totalComp.toLocaleString()} 元</div>
                        </div>
                    `;
                })
                .catch((error) => {
                    console.error("Error loading JSON:", error);
                    document.getElementById("output").innerHTML = "<p>讀取資料失敗，請確認 grades.json 是否存在且格式正確。</p>";
                });
        }

        // 修正項目：讓 Enter 鍵觸發查詢 (keypress event listener)
        document.getElementById("salary").addEventListener("keypress", function(event) {
            // 檢查按下的鍵是否為 Enter 鍵
            if (event.key === "Enter") {
                event.preventDefault(); // 阻止表單或其他默認行為
                document.querySelector(".input-group button").click(); // 模擬點擊查詢按鈕
            }
        });

        // 設定年份
        document.getElementById("year").innerText = new Date().getFullYear();
    </script>
</body>
</html>
