<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>114年勞保健保勞退查詢</title>
    <style>
        /* 調整風格：黑色文字，深色按鈕，貼近截圖的樣式 */
        body {
            font-family: Arial, "Helvetica Neue", Helvetica, sans-serif, "微軟正黑體", "Microsoft JhengHei";
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            background-color: white; /* 整個頁面背景使用白色 */
            color: #333;
        }
        h1 {
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        h4 {
            color: #333; /* 標題顏色與內文保持一致 */
            margin-top: 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
        }
        .input-group {
            display: flex;
            margin-bottom: 20px;
            gap: 5px; /* 按鈕間距縮小 */
        }
        #salary {
            flex-grow: 1;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 3px;
            /* 讓輸入框看起來更簡潔 */
        }
        .input-group button {
            padding: 10px 15px;
            font-size: 16px;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 3px;
            transition: background-color 0.3s;
            white-space: nowrap; /* 防止按鈕文字換行 */
        }
        /* 查詢按鈕樣式 (深色) */
        .input-group button.query-btn {
            background-color: #333; /* 黑色或深灰色 */
        }
        .input-group button.query-btn:hover {
            background-color: #555;
        }
        /* 重設按鈕樣式 (可選擇深色或略淺) */
        .input-group button.reset-btn {
            background-color: #777; 
        }
        .input-group button.reset-btn:hover {
            background-color: #555;
        }
        #output {
            background-color: white;
            padding: 0; /* 移除外層 padding，讓內容更貼近邊緣 */
            border-radius: 0;
            box-shadow: none; /* 移除陰影 */
            min-height: 50px; 
        }
        .section {
            margin-bottom: 20px; /* 增加區塊間距 */
        }
        .section ul {
            list-style: none;
            padding: 0;
            margin: 5px 0 10px 0;
            line-height: 2; /* 讓行距更寬鬆 */
        }
        .total {
            font-weight: bold;
            font-size: 1.1em;
            color: #333; /* 合計金額顏色與內文保持一致 */
            padding: 10px 0;
            border-top: 1px solid #ddd; /* 底部使用淺色分隔線 */
            margin-top: 10px;
        }
        .divider {
            display: none; /* 隱藏程式碼中原有的分割線 */
        }
        /* 針對結果區的文字做微調 */
        #output ul li {
            padding-left: 0;
        }
        .description-box {
            background-color: #f0f0f0; /* 說明區塊背景略淺 */
            color: #333;
            padding: 15px;
            border-left: 5px solid #333;
            margin-top: 20px;
            font-size: 0.9em;
        }
        .description-box h4 {
             border-bottom: none;
        }
    </style>
</head>
<body>

    <h1>114年勞保健保勞退查詢</h1>

    <p>只要輸入月薪，就能立刻查投保級距，對照薪資單不再霧煞煞。</p>

    <div class="input-group">
        <input type="number" id="salary" placeholder="請輸入月薪 (如：50000)">
        <button class="query-btn" onclick="calculate()">查詢</button>
        <button class="reset-btn" onclick="resetCalculator()">清除/重設</button>
    </div>

    <div id="output">
        </div>

    <div class="description-box">
        <h4>使用說明</h4>
        <ul>
            <li>本工具方便勞工快速查詢保險級距。</li>
            <li>可連線勞保局 e化系統比對投保資料。</li>
            <li>計算方式以「月」(30日) 為單位。</li>
            <li>健保僅算本人保費，不含眷屬保費。</li>
            <li>勞退依實際工資提繳 6%，不看級距。</li>
        </ul>
        <p style="color: #c0392b; font-weight: bold;">薪資總額的計算，依《勞基法》第2條第3款規定，除了本薪外，固定給付的獎金、津貼也要算進去。工資項目是否要列入，如有疑慮，請向勞動部或縣市政府勞工局諮詢確認。</p>
    </div>


    <script>
        // 輔助函式：根據薪資在級距表中找到對應的費用
        function getLevel(salary, list) {
            for (let i = 0; i < list.length; i++) {
                if (salary <= list[i].level) return list[i];
            }
            // 返回最高級距
            return list[list.length - 1];
        }

        function calculate() {
            const input = document.getElementById("salary").value.trim();

            if (!/^\d+$/.test(input)) {
                document.getElementById("output").innerHTML = "<p>⚠️ 請輸入整數金額，不要有小數點或文字。</p>";
                return;
            }

            const salary = parseInt(input, 10);
            if (salary <= 0) {
                document.getElementById("output").innerHTML = "<p>⚠️ 月薪必須大於 0。</p>";
                return;
            }

            fetch("grades.json")
                .then(res => res.json())
                .then(grades => {
                    // 1. 普保 (普通勞保) 費用
                    const labor = getLevel(salary, grades.labor);
                    // 2. 健保 費用
                    const health = getLevel(salary, grades.health);
                    // 3. 職保 (災保) 費用
                    const job = getLevel(salary, grades.job);
                    
                    // 4. 勞退 (最高 150,000 元)
                    const pension_base = Math.min(salary, 150000); 
                    const pension = {
                        level: salary,
                        company: Math.round(pension_base * 0.06),
                        employee: 0 
                    };

                    // 修正投保級距的計算與顯示邏輯
                    const labor_level_to_calculate = Math.min(salary, 45800); // 普保最高 45,800 元
                    const job_level_to_calculate = Math.min(salary, 72800); // 職保最高 72,800 元
                    
                    // 取得實際投保級距 
                    const labor_ins_level = getLevel(labor_level_to_calculate, grades.labor).level;
                    const job_ins_level = getLevel(job_level_to_calculate, grades.job).level;
                    const health_ins_level = health.level;


                    // 計算總額
                    const totalEmp = labor.employee + health.employee + pension.employee; 
                    const totalComp = labor.company + job.company + health.company + pension.company;

                    document.getElementById("output").innerHTML = `
                        <div class="section">
                            <h4>投保級距</h4>
                            <ul>
                                <li>勞保（普保）：${labor_ins_level.toLocaleString()} 元（最高 45,800 元）</li>
                                <li>職保（災保）：${job_ins_level.toLocaleString()} 元（最高 72,800 元）</li>
                                <li>健保：${health_ins_level.toLocaleString()} 元</li>
                                <li>勞退：${pension_base.toLocaleString()} 元（實際工資，最高 150,000 元）</li>
                            </ul>
                        </div>
                        <div class="section">
                            <h4>個人負擔</h4>
                            <ul>
                                <li>勞保（普保）：${labor.employee.toLocaleString()} 元</li>
                                <li>健保：${health.employee.toLocaleString()} 元</li>
                                <li>勞退：0 元</li>
                            </ul>
                            <div class="total">合計：${totalEmp.toLocaleString()} 元</div>
                        </div>
                        <div class="section">
                            <h4>公司負擔</h4>
                            <ul>
                                <li>勞保（普保）：${labor.company.toLocaleString()} 元</li>
                                <li>職保（災保）：${job.company.toLocaleString()} 元</li>
                                <li>健保：${health.company.toLocaleString()} 元</li>
                                <li>勞退：${pension.company.toLocaleString()} 元</li>
                            </ul>
                            <div class="total">合計：${totalComp.toLocaleString()} 元</div>
                        </div>
                    `;
                })
                .catch((error) => {
                    console.error("Error loading JSON:", error);
                    document.getElementById("output").innerHTML = "<p>讀取資料失敗，請確認 grades.json 是否存在且格式正確。</p>";
                });
        }

        // 函式：清除並重設計算機
        function resetCalculator() {
            document.getElementById("salary").value = ''; 
            document.getElementById("output").innerHTML = ''; 
            document.getElementById("salary").focus(); 
        }

        // 讓 Enter 鍵觸發查詢 
        document.getElementById("salary").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault(); 
                document.querySelector(".input-group button.query-btn").click(); 
            }
        });
    </script>
</body>
</html>
